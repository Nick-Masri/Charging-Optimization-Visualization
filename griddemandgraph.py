# %%
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from datetime import datetime
import seaborn as sns

sns.set_theme()

# %%
#
times = '''0:00	0:05	0:10	0:15	0:20	0:25	0:30	0:35	0:40	0:45	0:50	0:55	1:00	1:05	1:10	1:15	1:20	1:25	1:30	1:35	1:40	1:45	1:50	1:55	2:00	2:05	2:10	2:15	2:20	2:25	2:30	2:35	2:40	2:45	2:50	2:55	3:00	3:05	3:10	3:15	3:20	3:25	3:30	3:35	3:40	3:45	3:50	3:55	4:00	4:05	4:10	4:15	4:20	4:25	4:30	4:35	4:40	4:45	4:50	4:55	5:00	5:05	5:10	5:15	5:20	5:25	5:30	5:35	5:40	5:45	5:50	5:55	6:00	6:05	6:10	6:15	6:20	6:25	6:30	6:35	6:40	6:45	6:50	6:55	7:00	7:05	7:10	7:15	7:20	7:25	7:30	7:35	7:40	7:45	7:50	7:55	8:00	8:05	8:10	8:15	8:20	8:25	8:30	8:35	8:40	8:45	8:50	8:55	9:00	9:05	9:10	9:15	9:20	9:25	9:30	9:35	9:40	9:45	9:50	9:55	10:00	10:05	10:10	10:15	10:20	10:25	10:30	10:35	10:40	10:45	10:50	10:55	11:00	11:05	11:10	11:15	11:20	11:25	11:30	11:35	11:40	11:45	11:50	11:55	12:00	12:05	12:10	12:15	12:20	12:25	12:30	12:35	12:40	12:45	12:50	12:55	13:00	13:05	13:10	13:15	13:20	13:25	13:30	13:35	13:40	13:45	13:50	13:55	14:00	14:05	14:10	14:15	14:20	14:25	14:30	14:35	14:40	14:45	14:50	14:55	15:00	15:05	15:10	15:15	15:20	15:25	15:30	15:35	15:40	15:45	15:50	15:55	16:00	16:05	16:10	16:15	16:20	16:25	16:30	16:35	16:40	16:45	16:50	16:55	17:00	17:05	17:10	17:15	17:20	17:25	17:30	17:35	17:40	17:45	17:50	17:55	18:00	18:05	18:10	18:15	18:20	18:25	18:30	18:35	18:40	18:45	18:50	18:55	19:00	19:05	19:10	19:15	19:20	19:25	19:30	19:35	19:40	19:45	19:50	19:55	20:00	20:05	20:10	20:15	20:20	20:25	20:30	20:35	20:40	20:45	20:50	20:55	21:00	21:05	21:10	21:15	21:20	21:25	21:30	21:35	21:40	21:45	21:50	21:55	22:00	22:05	22:10	22:15	22:20	22:25	22:30	22:35	22:40	22:45	22:50	22:55	23:00	23:05	23:10	23:15	23:20	23:25	23:30	23:35	23:40	23:45	23:50	23:55'''
demandVTA = '''1.51449195705544	1.51903557949507	1.51478509398703	1.5100949030816	1.50635740720384	1.50086108973654	1.49734344655747	1.49192041332307	1.4859111062255	1.47902238833315	1.47315964970137	1.47110769118024	1.46524495254846	1.46062804587593	1.45828295042322	1.45505844417574	1.44948884247554	1.44641090469386	1.44216041918581	1.44084130299366	1.43827635484226	1.43468542743029	1.43146092118281	1.4288959730314	1.42684401451028	1.42449891905756	1.42611117218131	1.42120112857719	1.41892931735737	1.41658422190466	1.41614451650727	1.41658422190466	1.41299329449269	1.40962221977941	1.40793668242278	1.40595800813455	1.4046388919424	1.40595800813455	1.40940236708072	1.41028177787549	1.40669085046352	1.40676413469642	1.40705727162801	1.40837638782016	1.41079476750577	1.41108790443736	1.41196731523213	1.4154116741783	1.41526510571251	1.42208053937195	1.43234033197758	1.4343190062658	1.43849620754095	1.43996189219889	1.44201385072002	1.44956212670844	1.45439888607966	1.45498515994284	1.46070133010883	1.46832289033015	1.47411234472903	1.49214026602177	1.50936206075263	1.51705690520684	1.52541130775714	1.53251987834817	1.5398483016379	1.54783628302371	1.56066102378073	1.56923527902972	1.5750247334286	1.58374555714338	1.59862225642153	1.62529771719615	1.64955479828515	1.66347880253563	1.67864863874537	1.69110695833791	1.70034077168297	1.71082041698729	1.71873511414019	1.72826206441684	1.73449122421311	1.7400608259133	1.74929463925836	1.76431790700231	1.77604338426588	1.78285881792532	1.78659631380309	1.79297204206515	1.79670953794291	1.80293869773918	1.80836173097358	1.81422446960536	1.82089333479902	1.82389798834781	1.83181268550071	1.84148620424316	1.84449085779195	1.85050016488952	1.84962075409476	1.85299182880803	1.85775530394636	1.8593675570701	1.85614305082262	1.85709574585028	1.85863471474112	1.86295848448206	1.86332490564655	1.86090652596094	1.86141951559122	1.86303176871496	1.8618592209886	1.85291854457513	1.84434428932615	1.8403869407497	1.83445091788502	1.83159283280202	1.82580337840314	1.82822175808875	1.82719577882819	1.82389798834781	1.81722912315415	1.81217251108424	1.80682276208274	1.80975413139863	1.80938771023414	1.8051372247261	1.79670953794291	1.79062694661244	1.78879484079	1.7807335751713	1.77604338426588	1.78740244036496	1.78234582829504	1.77677622659485	1.77157304605914	1.76622329705764	1.7591147264666	1.75486424095856	1.7481953757649	1.7429189109963	1.73859514125536	1.73339196071965	1.73046059140376	1.73134000219853	1.71565717635851	1.69938807665531	1.69674984427101	1.68817558902202	1.67886849144407	1.6807738814994	1.67886849144407	1.6752042797992	1.67344545820967	1.67139349968854	1.672492763182	1.66743615111209	1.66465135026199	1.66120699131582	1.65563738961562	1.65211974643655	1.64251951192701	1.63321241434905	1.63086731889634	1.63489795170569	1.6346048147741	1.63826902641897	1.63401854091092	1.62742295995017	1.62214649518156	1.61950826279726	1.62236634788025	1.62720310725147	1.62881536037522	1.63028104503316	1.62800923381335	1.63555750980177	1.6455974497087	1.64911509288777	1.65483126305375	1.65072734601151	1.65211974643655	1.65527096845114	1.65783591660254	1.66010772782236	1.66538419259096	1.6698545307977	1.6779157964164	1.68832215748782	1.69535744384596	1.70429812025943	1.71074713275439	1.70950130079513	1.72093364112711	1.72994760177348	1.74159979480415	1.75310541936902	1.76145982191931	1.7726723095526	1.7808801436371	1.79355831592833	1.80499065626031	1.81730240738705	1.82829504232164	1.83430434941922	1.84251218350372	1.85760873548056	1.87050676047048	1.88384449085779	1.90333809680847	1.9187277857169	1.9351434538859	1.95441720713788	1.97105272800557	1.98358433183101	1.99230515554578	1.99406397713532	1.99618921988934	1.99809460994467	1.99846103110916	1.99919387343813	2	1.99648235682093	1.99574951449196	1.99340441903924	1.99274486094317	1.98886079659961	1.98065296251511	1.97508336081492	1.97222527573193	1.9702466014437	1.9648968524422	1.95888754534462	1.95434392290499	1.95089956395881	1.945769667656	1.94276501410721	1.93924737092815	1.93294492689898	1.92488366128028	1.91894763841559	1.91264519438643	1.9051702026309	1.90113956982155	1.89659594738192	1.89051335605145	1.88399105932359	1.87856802608919	1.87153273973105	1.8647173060716	1.85563006119233	1.84808178520391	1.84485727895643	1.83657616063904	1.82917445311641	1.82301857755304	1.81312520611191	1.80389139276685	1.79788208566927	1.79128650470851	1.7808801436371	1.77384485727896	1.76387820160492	1.75193287164267	1.73822872009087	1.73229269722619	1.72379172621011	1.71375178630318	1.70341870946466	1.69183980066689	1.68136015536257	1.67168663662013	1.66245282327507	1.65102048294309	1.64259279615991	1.63577736250046	1.62053424205782	1.6130592503023	1.60917518595874	1.59979480414789	1.59246638085816	1.58271957788282	1.57473159649701	1.5671100362757	1.55978161298597	1.55186691583306	1.54336594481697
'''
demand = '''20666	20728	20670	20606	20555	20480	20432	20358	20276	20182	20102	20074	19994	19931	19899	19855	19779	19737	19679	19661	19626	19577	19533	19498	19470	19438	19460	19393	19362	19330	19324	19330	19281	19235	19212	19185	19167	19185	19232	19244	19195	19196	19200	19218	19251	19255	19267	19314	19312	19405	19545	19572	19629	19649	19677	19780	19846	19854	19932	20036	20115	20361	20596	20701	20815	20912	21012	21121	21296	21413	21492	21611	21814	22178	22509	22699	22906	23076	23202	23345	23453	23583	23668	23744	23870	24075	24235	24328	24379	24466	24517	24602	24676	24756	24847	24888	24996	25128	25169	25251	25239	25285	25350	25372	25328	25341	25362	25421	25426	25393	25400	25422	25406	25284	25167	25113	25032	24993	24914	24947	24933	24888	24797	24728	24655	24695	24690	24632	24517	24434	24409	24299	24235	24390	24321	24245	24174	24101	24004	23946	23855	23783	23724	23653	23613	23625	23411	23189	23153	23036	22909	22935	22909	22859	22835	22807	22822	22753	22715	22668	22592	22544	22413	22286	22254	22309	22305	22355	22297	22207	22135	22099	22138	22204	22226	22246	22215	22318	22455	22503	22581	22525	22544	22587	22622	22653	22725	22786	22896	23038	23134	23256	23344	23327	23483	23606	23765	23922	24036	24189	24301	24474	24630	24798	24948	25030	25142	25348	25524	25706	25972	26182	26406	26669	26896	27067	27186	27210	27239	27265	27270	27280	27291	27243	27233	27201	27192	27139	27027	26951	26912	26885	26812	26730	26668	26621	26551	26510	26462	26376	26266	26185	26099	25997	25942	25880	25797	25708	25634	25538	25445	25321	25218	25174	25061	24960	24876	24741	24615	24533	24443	24301	24205	24069	23906	23719	23638	23522	23385	23244	23086	22943	22811	22685	22529	22414	22321	22113	22011	21958	21830	21730	21597	21488	21384	21284	21176	21060
'''

timeList = times.split()
demandListVTA = demandVTA.split()
demandList = demand.split()

for idx, demand in enumerate(demandListVTA):
    demandListVTA[idx] = round(float(demand), 2)

for idx, demand in enumerate(demandList):
    demandList[idx] = round(float(demand), 2)
# %%
plt.clf()
from matplotlib.ticker import FormatStrFormatter
from matplotlib import dates

fig, (ax1, ax3) = plt.subplots(2, 1, figsize=(4.5,3), sharex=True)
DATE = [datetime.strptime(x, '%H:%M') for x in timeList]

fmtr = dates.DateFormatter("%H:%M")

# ax1
ax1.set_ylabel("MW")
ax1.set_title("CAISO Normal Day Grid Demand Curve")
ax1.set_ylim(18500, 30000)
ax1.xaxis.set_major_formatter(fmtr)
ax1.plot(DATE, demandList, color='darkblue', linewidth=2)

# # ax2
# ax2.xaxis.set_major_formatter(fmtr)
# ax2.set_ylabel("MW")
# ax2.set_title("Adjusted Grid Demand for 2MW system", )
# ax2.set_ylim(1, 2.5)
# ax2.plot(DATE, demandListVTA, color='royalblue', linewidth=2)

# ax3
plt.setp(ax3.xaxis.get_majorticklabels(), rotation=45 )

ax3.xaxis.set_major_formatter(fmtr)
ax3.set_ylabel("KW")
ax3.set_title("Remaining Grid Power Available")
ax3.set_ylim(-10,550)
# ax3.set_yticks(ticks=[0, 125, 250, 375, 500])
# ax3.set_ylim(-.1, 0.8)
demandLeft = demandListVTA.copy()
for idx, demand in enumerate(demandListVTA):
    demandLeft[idx] = 500*(10/6)*(2-demandListVTA[idx])
ax3.plot(DATE, demandLeft, color='g', linewidth=2)

fig.tight_layout()

fig.show()
fig.savefig('gridpowavail.eps', format='eps')
